{% set page = "home" %}
{% extends "_base.html" %}
{% block head %}
<link rel="stylesheet" href="{{ base }}/jquery.qtip.min.css">
{% endblock %}
{% block body %}
<div id="content">
	<h1 class="page-header">Home</h1>
	<p>Welcome to Adhesome</p>
	<div id="graph" style="width: 400px; height:400px;"></div>
	<div>
		<p><span class="b">Stats</span></p>
		<p id="graph-stats"></p>
	</div>
</div>
{% endblock %}
{% block scripts %}
<script src="{{ base }}/js/cytoscape.min.js"></script>
<script src="{{ base }}/js/jquery.qtip.min.js"></script>
<script src="{{ base }}/js/cytoscape-qtip.js"></script>
<script src="{{ base }}/js/cola.v3.min.js"></script>
<script src="{{ base }}/js/cytoscape-cola.js"></script>
{% set cur = get_cursor() %}
{% set node_view %}
	create temp view `intrinsic_nodes` as
	select `Official Symbol`, `FA`
	from `components`
	where `FA`="Intrinsic Proteins";
{% endset %}
{% set edge_view %}
	create temp view `intrinsic_edges` as
	select
		`Source`,
		`Target`,
		`PMID`
	from
		`edges`
	where
		`Source` in (select `Official Symbol` from `intrinsic_nodes`)
	and `Target` in (select `Official Symbol` from `intrinsic_nodes`);
{% endset %}
{% set res = cur|query_exec(node_view.format(name)), cur|query_exec(edge_view.format(name)) %}
{% set nodes = (cur|query('select * from intrinsic_nodes')).data %}
{% set edges = (cur|query('select * from intrinsic_edges')).data %}
{% set res = cur|query_exec('drop view `intrinsic_nodes`'), cur|query_exec('drop view `intrinsic_edges`') %}
<script>
{% set base = base %}
{% include "_graph.html" %}
</script>
{% endblock %}
